<!DOCTYPE html>
<html>
  <head>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://unpkg.com/d3-simple-slider"></script>
	<script src="../filters/filters.js"></script>

<!-- 	<link
	  rel="stylesheet"
	  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
	  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
	  crossorigin="anonymous"
	/> -->

	<link rel="stylesheet" type="text/css" href="../filters/filters.css"/>
<style>
.zipcode {
  stroke: steelblue;
  /* fill: #FFF; */
}
/*
tooltip styling*/
.d3-tip {
  line-height: 1;
  padding: 6px;
  background: rgba(188, 224, 224, 0.74);
  border-radius: 4px solid black;
  font-size: 12px;
}
</style>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="chicagoHeatMap.js"></script>
<!-- script needed for making tooltips: -->
<script src="d3-tooltips.js"></script> 
<!-- <script src="Avg-SAT-by-Zip-Chi.csv.js"></script> -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<body>
  <div class="row" style="padding: 20px;">
    
    <div class="ui-box" style='border-style: solid; border-width: 2px; width: 370px; border-color: #a3a3a3' >
        <div class="priceRange">
          <h6 align="center">Price Range</h6>
          <p id="value-range"></p>
        </div>
  
        <div class="col-sm">
          <div id="slider-range">
          </div>
        </div>
  
        <div class="SATSlider">
          <h6 align="center">SAT Score Range</h6>
          <p id ="SATtext"></p>
        </div>
  
        <div class="SAT-slider">
          <div id="SAT-range">
          </div>
        </div>
  
  
      
        <!-- The checkbox amenitites -->
        <div class="check-boxes" >	
          <h6 align="center">Amenities</h6>
          <label class ="container-bootstrap-override">Parks
            <input type="checkbox" class="myCheckbox" value="parks"/> 
            <span class="checkmark"></span>
          </label>
           <label class ="container-bootstrap-override">Police Stations
             <input type="checkbox" class="myCheckbox" value="police"> 
             <span class="checkmark"></span>
           </label>
           <label class ="container-bootstrap-override">Schools
             <input type="checkbox" class="myCheckbox" value="schools">
             <span class="checkmark"></span>
           </label>
           <label class ="container-bootstrap-override">Health Clinics
             <input type="checkbox" class="myCheckbox" value="health-clinics">	
             <span class="checkmark"></span>
           </label>
        </div>
      <button type="button" onclick="getData()">Done</button>
    </div>

    <div >
        <svg id="chart" width="700" height="450"></svg>
      </div>
  </div>
    
</body>
<script>

	var chartSvg = d3.select("#chart")
	var satSvg = d3.select("#SAT")

//initialize the heat map to default settings:
	// var initPrice = sliderRange.value().map(d3.format('.2r'));
	// var initMinPrice = +initPrice[0]; 
	// var initMaxPrice = +initPrice[1];

	// var initSAT = sliderRangeSAT.value().map(d3.format('.3r'));
	// var initSATmin = +initSAT[0];
	// var initSATmax = +initSAT[1];
	// console.log(initMinPrice);

	var HM = heatMapVis();
	HM.drawMap(chartSvg, 400, 0, 3000, 0, 0) /*svg, sat-min, minprice, maxprice, parks, schools*/

	HM.dispatch.on("selected",
  		function(d){
        	console.log(d);
        	console.log(`AVG sat is: ${d}`);
    	});



  /*
  data comes from: https://github.com/smartchicago/chicago-atlas/blob/master/db/import/zipcodes.geojson
  lots of help from http://stackoverflow.com/questions/14492284/center-a-map-in-d3-given-a-geojson-object
  */

  //NOTE: To get current range, use "pricerange" array.
		//  	To get current checked boxes, use "checked" array.
		//		To get current SAT range, use "SATrange"



	myText = d3.select(".ui-box")
		.append("text")
		.attr('font-size', '12')
		.attr('id', "textline")
  		;


	var gRange = d3
		.select('div#slider-range')
		.append('svg')
		.attr('width', 500)
		.attr('height', 90)
		.append('g')
		.attr('transform', 'translate(30,30)');


	// var checked = []; 
	// var pricerange = []; 
	// var minPrice = null;
	// var maxPrice =null;
	// var SATrange = []; 
	   

		//Code for price slider:
	var sliderRange = d3
	 	.sliderBottom()
		.min(d3.min(dataSlider))
		.max(d3.max(dataSlider))
		.width(250)
	    .tickFormat(d3.format('.02s'))
	    .ticks(5)
	    .default([2000, 2500])
	    .fill('#2196f3')
	    .on('onchange', val => {
		    d3.select('p#value-range')
		      .text("From " + val.map(d3.format('.02s'))
		      .join(' to '))
		     // var pricerange = val.map(d3.format('.2r'));
		     // minPrice = +pricerange[0];
		     // maxPrice = +pricerange[1];
		});

		 gRange.call(sliderRange);

		init_priceText(); 

			var sliderRangeSAT = d3
		   .sliderBottom()
		   .min(d3.min(dataSliderSAT))
		   .max(d3.max(dataSliderSAT))
		   .width(250)
	       .tickFormat(d3.format('0'))
	       .ticks(5)
	       .default([1000, 1300])
	       .fill('#2196f3')
	       .on('onchange', val => {
		      d3.select('p#SATtext')
		      	.text("From " + val.map(d3.format('.3r'))
		      	.join(' to '))
		      	// SATrange = val.map(d3.format('.3r'));
		    });


		//on click event handling for checkboxes
		d3.selectAll(".myCheckbox")
			.on("change", update);


		var gRangeSAT = d3
		   .select('div#SAT-range')
		   .append('svg')
		   .attr('width', 500)
		   .attr('height', 90)
		   .append('g')
		   .attr('transform', 'translate(30,30)');

		gRangeSAT.call(sliderRangeSAT);

		init_SATtext();


	function updateChecks() {

	}

	function getData(){

		var parks = 0;
		var schools = 0;

		var minPrice =sliderRange.value().map(d3.format('.2r'))[0];
		var maxPrice =sliderRange.value().map(d3.format('.2r'))[1];
		
		var minSAT = sliderRangeSAT.value().map(d3.format('.3r'))[0];
		var maxSAT = sliderRangeSAT.value().map(d3.format('.3r'))[1];
		
		var checkArr = update();

		checkArr.includes("parks") ? parks = 1 : parks = 0;
		checkArr.includes("schools") ? schools = 1 : schools = 0;
		console.log(parks);
	}


</script>

</html>