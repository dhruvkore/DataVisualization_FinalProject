<!DOCTYPE html>
<html>
  <head>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://unpkg.com/d3-simple-slider"></script>
	<script src="../filters/filters.js"></script>

<!-- 	<link
	  rel="stylesheet"
	  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
	  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
	  crossorigin="anonymous"
	/> -->

	<link rel="stylesheet" type="text/css" href="../filters/filters.css"/>
<style>
.zipcode {
  stroke: steelblue;
  /* fill: #FFF; */
}
/*
tooltip styling*/
.d3-tip {
  line-height: 1;
  padding: 6px;
  background: rgba(188, 224, 224, 0.74);
  border-radius: 4px solid black;
  font-size: 12px;
}
</style>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="chicagoHeatMap.js"></script>
<script src="barChart.js"></script>
<!-- script needed for making tooltips: -->
<script src="d3-tooltips.js"></script> 
<!-- <script src="Avg-SAT-by-Zip-Chi.csv.js"></script> -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
		<div class="container-fluid">
				<div class="row" style="background-color: #657B9F">
		<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #657B9F">
				<h2 class="navbar-brand">ChicagoCityMaps</h2>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
				<div class="collapse navbar-collapse">
					<ul class="navbar-nav mr-auto">
						<li class="nav-item">
								<a class="nav-link" href="map2.html">Apartment Filtered Rating Map</a>
						</li>
						<li class="nav-item active">
								<a class="nav-link" href="satvsrent.html">Rent vs SAT scores</a>
						</li>
						<li class="nav-item">
								<a class="nav-link" href="scatterSATvRent.html">Scatter Comparison</a>
						</li>
					</ul>
				</div>
			</nav>
		</div>
	<div class="title" style="text-align: center; padding-top:30px;">
			<h3 class="title">Rent vs SAT scores</h3>
			<p>Click on zipcodes to compare</p>
		</div>

  <div class="row" style="padding: 20px;">
    <div class="col-md">
        <svg id="chart" width="700" height="450"></svg>
		</div>
		<div class="col-sm">
    <div style='border-style: solid; border-width: 2px; width: 200px; height: 230px; border-color: #a3a3a3'>
      <p id='barTitle'></p>
      <svg id="barChart" width="200" height="90"></svg>
      <p id='secondBarTitle'></p>
      <svg id="secondBarChart" width="200" height="90"></svg>
		</div>
		</div>
  </div>

	<div id="specificRating"></div>
	
	<footer margin="0" class="row" style="background-color:  #657B9F; color: #fff; padding-top: 10px;">
			<div margin="0" class="col-sm">
				<p margin="0" style="vertical-align: bottom;">Chhuon, Kore, Swanson &nbsp;&nbsp;&nbsp;&nbsp;2019</p>
			</div>
	</footer>
		</div>
</body>
<script>

	var chartSvg = d3.select("#chart")
	var satSvg = d3.select("#SAT")

//initialize the heat map to default settings:
	// var initPrice = sliderRange.value().map(d3.format('.2r'));
	// var initMinPrice = +initPrice[0]; 
	// var initMaxPrice = +initPrice[1];

	// var initSAT = sliderRangeSAT.value().map(d3.format('.3r'));
	// var initSATmin = +initSAT[0];
	// var initSATmax = +initSAT[1];
	// console.log(initMinPrice);

    var HM = heatMapVis();
    var hasToolTip = 1;
	HM.drawMap(chartSvg, 400, 0, 3000, 0, 0, hasToolTip) /*svg, sat-min, minprice, maxprice, parks, schools*/

	HM.dispatch.on("selected",
  		function(d){
        	console.log(d);
        	console.log(`AVG sat is: ${d}`);
    	});

	myText = d3.select(".ui-box")
		.append("text")
		.attr('font-size', '12')
		.attr('id', "textline");

	var gRange = d3
		.select('div#slider-range')
		.append('svg')
		.attr('width', 500)
		.attr('height', 90)
		.append('g')
		.attr('transform', 'translate(30,30)');
	   

		//Code for price slider:
	var sliderRange = d3
	 	.sliderBottom()
		.min(500)
		.max(d3.max(dataSlider))
		.width(250)
	    .tickFormat(d3.format('.02s'))
	    .ticks(5)
	    .default([2000, 2500])
	    .fill('#2196f3')
	    .on('onchange', val => {
		    d3.select('p#value-range')
		      .text("From " + val.map(d3.format('.02s'))
		      .join(' to '))
		     // var pricerange = val.map(d3.format('.2r'));
		     // minPrice = +pricerange[0];
		     // maxPrice = +pricerange[1];
		});

		 gRange.call(sliderRange);

		init_priceText(); 

		var sliderRangeSAT = d3
		   .sliderBottom()
		   .min(d3.min(dataSliderSAT))
		   .max(d3.max(dataSliderSAT))
		   .width(250)
	       .tickFormat(d3.format('0'))
	       .ticks(5)
	       .default([1000, 1300])
	       .fill('#2196f3')
	       .on('onchange', val => {
		      d3.select('p#SATtext')
		      	.text("From " + val.map(d3.format('.3r'))
		      	.join(' to '))
		      	// SATrange = val.map(d3.format('.3r'));
		    });


		//on click event handling for checkboxes
		d3.selectAll(".myCheckbox")
			.on("change", update);


		var gRangeSAT = d3
		   .select('div#SAT-range')
		   .append('svg')
		   .attr('width', 500)
		   .attr('height', 90)
		   .append('g')
		   .attr('transform', 'translate(30,30)');

		gRangeSAT.call(sliderRangeSAT);

		init_SATtext();

	function getData(){

    var chartSvg = d3.select("#chart")
    var satSvg = d3.select("#SAT")

		var parks = 0;
		var schools = 0;
		var hasToolTip = 1;

		var minPrice = Number(sliderRange.value().map(d3.format('.2r'))[0]);
		var maxPrice = Number(sliderRange.value().map(d3.format('.2r'))[1]);
		
		var minSAT = Number(sliderRangeSAT.value().map(d3.format('.3r'))[0]);
		var maxSAT = Number(sliderRangeSAT.value().map(d3.format('.3r'))[1]);
		
		var checkArr = update();

		checkArr.includes("parks") ? parks = 1 : parks = 0;
		checkArr.includes("schools") ? schools = 1 : schools = 0;

		var reMap = heatMapVis();
		
    console.log("test HERE")
    console.log("minPrice " + minPrice)
    console.log("maxPrice " + maxPrice)
    console.log("parks " + parks)
    console.log("schools " + schools)

    reMap.drawMap(chartSvg, minSAT, minPrice, maxPrice, parks, schools, hasToolTip)
		//reMap.drawMap(chartSvg, 400, 0, 3000, 0, 0) /*svg, sat-min, minprice, maxprice, parks, schools*/
	}


  /*
  data comes from: https://github.com/smartchicago/chicago-atlas/blob/master/db/import/zipcodes.geojson
  lots of help from http://stackoverflow.com/questions/14492284/center-a-map-in-d3-given-a-geojson-object
  */

</script>

</html>